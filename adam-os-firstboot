#!/bin/sh
# the idea is to replace this w/https://github.com/Vanilla-OS/first-setup

if test -e "$HOME"/.config/adam-os/firstboot-done; then
    echo "Already ran"
    exit 0
fi

(
echo "# Waiting for Internet connection"
until /usr/bin/ping -q -c 1 flathub.org; do sleep 1; done
echo "00"

# setup/configure zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
echo "10"

git clone https://github.com/AdamIsrael/dotfiles.git .dotfiles && \
    rm .zshrc && ln -s .dotfiles/zshrc .zshrc
echo "20"


echo "# Reticulating Final Splines"
mkdir -p "$HOME"/.config/adam-os/
touch "$HOME"/.config/adam-os/firstboot-done
) |
     
   zenity --progress --title="uBlue Desktop Firstboot" --percentage=0 --auto-close --no-cancel --width=300

if [ "$?" != 0 ] ; then
        zenity --error \
          --text="Firstboot Configuration Error"
fi